module.exports=function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(e,t){e.exports=require("react")},function(e,t,o){"use strict";o.r(t),o.d(t,"GoogleButton",(function(){return R})),o.d(t,"isLoggedIn",(function(){return i})),o.d(t,"logOutOAuthUser",(function(){return s})),o.d(t,"createOAuthHeaders",(function(){return l})),o.d(t,"GoogleAuth",(function(){return x})),o.d(t,"GoogleAuthConsumer",(function(){return w})),o.d(t,"getAccessToken",(function(){return u})),o.d(t,"setPrompt",(function(){return _})),o.d(t,"exchangeToken",(function(){return f}));var n=function(){return(n=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=function(e,t,o,n){return new(o||(o=Promise))((function(r,c){function a(e){try{s(n.next(e))}catch(e){c(e)}}function i(e){try{s(n.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}s((n=n.apply(e,t||[])).next())}))},c=function(e,t){var o,n,r,c,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return c={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function a(e){var t=e.code;(function(e,t){return r(this,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})];case 1:return[2,o.sent().json()]}}))}))})(e.apiUrl,{code:t,scope:e.scope}).then((function(t){"access_token"in t?e.setResponseState({accessToken:t.access_token}):e.setResponseState({error:"so access_token in response data!"})})).catch((function(t){e.setResponseState({error:t.message})}))}function i(){return!!window.localStorage.getItem("accessToken")}function s(){window.localStorage.removeItem("accessToken")}function u(){return window.localStorage.getItem("accessToken")}function l(e){var t={};return e&&(t={"X-Auth-Resource":e}),n(n({},t),{"X-Auth-Token":"Bearer ".concat(u())})}function p(){var e=document.location.href;if(document.location.search){var t=e.substring(0,e.indexOf("?"));window.history.replaceState({},document.title,t)}}function f(e,t,o){var n="".concat("https://oauth2.googleapis.com/token","?");return n+="client_id=".concat(e),n+="&grant_type=refresh_token",n+="&refresh_token=".concat(t),n+="&client_secret=".concat(o),fetch(n,{method:"POST"}).then((function(e){return e.json().then((function(e){if(e.error)throw new Error(e.error);return window.localStorage.setItem("accessToken",e.access_token),e.access_token}))})).catch((function(e){throw console.debug(e),new Error("Failed to refresh access token")}))}var d,h=o(0),g=o.n(h);!function(e){e.GOOGLE_OAUTH_ENDPOINT="https://accounts.google.com/o/oauth2/v2/auth"}(d||(d={}));var b=function(){function e(e,t){var o=this;this.redirect=function(e){if(!o.googleRedirectURL)throw new ReferenceError("Error creating redirect url to Google's authorization server");window.location.replace(o.googleRedirectURL)},this.params=e,this.scopesStr=t}return Object.defineProperty(e.prototype,"googleRedirectURL",{get:function(){return this._googleRedirectURL},set:function(e){this._googleRedirectURL=e},enumerable:!1,configurable:!0}),e.prototype.createAuthorizationRequestURL=function(){var e,t=this.params,o=t.accessType,n=void 0===o?"offline":o,r=t.includeGrantedScopes,c=void 0===r||r,a=t.responseType,i=void 0===a?"code":a,s=t.state,u=void 0===s?null:s,l=t.redirectUri,p=t.clientId,f=t.loginHint,h=t.prompt,g=d.GOOGLE_OAUTH_ENDPOINT;e="".concat(g,"?scope=").concat(this.scopesStr,"&"),e=n?"".concat(e,"access_type=").concat(n,"&"):e,e="".concat(e,"include_granted_scopes=").concat(c,"&"),e="".concat(e,"response_type=").concat(i,"&"),e=u?"".concat(e,"state=").concat(u,"&"):e,e=f?"".concat(e,"login_hint=").concat(f,"&"):e,e=h?"".concat(e,"prompt=").concat(h,"&"):e,e="".concat(e,"redirect_uri=").concat(l,"&"),e="".concat(e,"client_id=").concat(p),this.googleRedirectURL=e},e.createScopes=function(e){var t="";return e.map((function(o,n){e.length-1===n?t+="".concat(o):t+="".concat(o,"%20")})),t},e}(),v=function(){return(v=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},m={},y={backgroundSize:"20px 20px",backgroundRepeat:"no-repeat",backgroundPosition:"12px 10px",textIndent:"19px",border:"1px solid #bdc3c7",padding:"9px 23px",borderRadius:"9px",backgroundColor:"#bdc3c7",fontSize:"18px"},O=g.a.createContext({setOAuthState:function(){},setOptions:function(){},setPrompt:function(){},setResponseState:function(){}}),S=O.Provider,w=O.Consumer,k=function(e){var t=e.placeholder,o=void 0===t?"":t,n=e.defaultStyle,r=void 0===n||n,c=e.options,a=e.displayErrors,i=void 0!==a&&a,s=b.createScopes(c.scopes),u=new b(c,s);u.createAuthorizationRequestURL();var l=r?function(e,t){return e?v(v({},t),{backgroundImage:"url(".concat(e,")")}):t}(o,y):void 0;return e.error&&console.error("[React-Google-OAuth2] Error: ".concat(e.error,"\n         - To display the error to the user, set IGoogleProps displayErrors to true.\n         See https://joegasewicz.github.io/react-google-oauth2.0/")),p(),g.a.createElement(g.a.Fragment,null,g.a.createElement("button",{style:l,onClick:u.redirect,className:"".concat(e.className," google-oauth-btn")},e.children),i&&e.error&&g.a.createElement("div",null,e.error))};function R(e){var t=e.callback,o=Object(h.useContext)(O),n=o.options,r=o.setOptions,c=o.responseState,s=o.setOAuthState,u=o.setResponseState,l=o.isAuthenticated,f=Object(h.useState)(),d=f[0],b=f[1],m=new URLSearchParams(window.location.search),y=m.get("code"),S=m.get("error");Object(h.useEffect)((function(){!n&&r&&r(e.options)}),[e.options]),Object(h.useEffect)((function(){c&&!Object.keys(c).length&&d&&a(d)}),[d,c]),Object(h.useEffect)((function(){var e;(null==c?void 0:c.accessToken)&&!i()&&(e=c.accessToken,window.localStorage.setItem("accessToken",e),console.debug("`accessToken` set in local storage."),"function"!=typeof s||l||s(!0))}),[null==c?void 0:c.accessToken]);var w=v(v({},e.options),n),R=g.a.createElement(k,v({},e,{placeholder:e.placeholder,error:null==c?void 0:c.error,options:w}));if(null==c?void 0:c.error)return console.error("[React-Google-OAuth2] Error: Api call failed with ".concat(null==c?void 0:c.error," error.")),R;if(y&&!i()){var _={email:m.get("email")||"",scope:m.get("scope")||"",code:y,client_id:e.options.clientId,apiUrl:e.apiUrl,responseState:c,setResponseState:u};return p(),c&&!Object.keys(c).length&&b(_),console.debug("Waiting for remote api response"),t?t():g.a.createElement(g.a.Fragment,null,"Loading...")}return S?(console.error("Error: Google login attempt failed with ".concat(S," error.")),R):R}function _(e,t){return function(o){t&&!t.prompt&&e(v(v({},t),{prompt:o}))}}var x=function(e){var t=Object(h.useState)(m),o=t[0],n=t[1],r=Object(h.useState)(i()),c=r[0],a=r[1],s=Object(h.useState)(),u=s[0],l=s[1],p={isAuthenticated:c,setOAuthState:a,responseState:o,setResponseState:n,options:u,setOptions:l,setPrompt:_(l,u)};return g.a.createElement(S,{value:p},e.children)}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yZWFjdC1nb29nbGUtb2F1dGgvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vcmVhY3QtZ29vZ2xlLW9hdXRoL2V4dGVybmFsIFwicmVhY3RcIiIsIndlYnBhY2s6Ly9yZWFjdC1nb29nbGUtb2F1dGgvLi9zcmMvYXBpVXRpbHMudHMiLCJ3ZWJwYWNrOi8vcmVhY3QtZ29vZ2xlLW9hdXRoLy4vc3JjL2F1dGhvcml6YXRpb24udHMiLCJ3ZWJwYWNrOi8vcmVhY3QtZ29vZ2xlLW9hdXRoLy4vc3JjL2NvbXBvbmVudHMudHN4Il0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwicmVxdWlyZSIsInNlcnZlclJlc3BvbnNlIiwicHJvcHMiLCJjb2RlIiwiYXBpVXJsIiwicGF5bG9hZCIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwianNvbiIsInBvc3RUb0V4Y2hhbmdlQXBpVXJsIiwic2NvcGUiLCJ0aGVuIiwiZGF0YSIsInNldFJlc3BvbnNlU3RhdGUiLCJhY2Nlc3NUb2tlbiIsImFjY2Vzc190b2tlbiIsImVycm9yIiwiY2F0Y2giLCJlcnIiLCJtZXNzYWdlIiwiaXNMb2dnZWRJbiIsIndpbmRvdyIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJsb2dPdXRPQXV0aFVzZXIiLCJyZW1vdmVJdGVtIiwiZ2V0QWNjZXNzVG9rZW4iLCJjcmVhdGVPQXV0aEhlYWRlcnMiLCJyZXNvdXJjZSIsInJlc291cmNlSGVhZGVycyIsInJlbW92ZU9BdXRoUXVlcnlQYXJhbXMiLCJjdXJyZW50TG9jYXRpb24iLCJkb2N1bWVudCIsImxvY2F0aW9uIiwiaHJlZiIsInNlYXJjaCIsImNsZWFuX3VyaSIsInN1YnN0cmluZyIsImluZGV4T2YiLCJoaXN0b3J5IiwicmVwbGFjZVN0YXRlIiwidGl0bGUiLCJleGNoYW5nZVRva2VuIiwiY2xpZW50SWQiLCJyZWZyZXNoVG9rZW4iLCJjbGllbnRTZWNyZXQiLCJ1cmwiLCJFcnJvciIsInNldEl0ZW0iLCJjb25zb2xlIiwiZGVidWciLCJHb29nbGVBUElDb25uZWN0aW9uU3RyaW5ncyIsInBhcmFtcyIsInNjb3Blc1N0ciIsInJlZGlyZWN0IiwiZSIsImdvb2dsZVJlZGlyZWN0VVJMIiwiUmVmZXJlbmNlRXJyb3IiLCJyZXBsYWNlIiwidGhpcyIsIl9nb29nbGVSZWRpcmVjdFVSTCIsImNyZWF0ZUF1dGhvcml6YXRpb25SZXF1ZXN0VVJMIiwiYWNjZXNzVHlwZSIsImluY2x1ZGVHcmFudGVkU2NvcGVzIiwicmVzcG9uc2VUeXBlIiwic3RhdGUiLCJyZWRpcmVjdFVyaSIsImxvZ2luSGludCIsInByb21wdCIsImRvbWFpbiIsIkdPT0dMRV9PQVVUSF9FTkRQT0lOVCIsImNyZWF0ZVNjb3BlcyIsInNjb3BlcyIsInN0ciIsIm1hcCIsImxlbmd0aCIsIlNFUlZFUl9SRVNQT05TRV9TVEFURSIsImJ1dHRvblN0eWxpbmciLCJiYWNrZ3JvdW5kU2l6ZSIsImJhY2tncm91bmRSZXBlYXQiLCJiYWNrZ3JvdW5kUG9zaXRpb24iLCJ0ZXh0SW5kZW50IiwiYm9yZGVyIiwicGFkZGluZyIsImJvcmRlclJhZGl1cyIsImJhY2tncm91bmRDb2xvciIsImZvbnRTaXplIiwiR29vZ2xlQXV0aENvbnRleHQiLCJjcmVhdGVDb250ZXh0Iiwic2V0T0F1dGhTdGF0ZSIsInNldE9wdGlvbnMiLCJzZXRQcm9tcHQiLCJHb29nbGVBdXRoUHJvdmlkZXIiLCJQcm92aWRlciIsIkdvb2dsZUF1dGhDb25zdW1lciIsIkNvbnN1bWVyIiwiSW5uZXJCdXR0b24iLCJwbGFjZWhvbGRlciIsImRlZmF1bHRTdHlsZSIsIm9wdGlvbnMiLCJkaXNwbGF5RXJyb3JzIiwiQXV0aG9yaXphdGlvbiIsImF1dGgiLCJzdHlsZXMiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJfZ2V0QmFja2dyb3VuZEltZyIsInVuZGVmaW5lZCIsInN0eWxlIiwib25DbGljayIsImNsYXNzTmFtZSIsImNoaWxkcmVuIiwiR29vZ2xlQnV0dG9uIiwiY2FsbGJhY2siLCJyZXNwb25zZVN0YXRlIiwiaXNBdXRoZW50aWNhdGVkIiwic2VydmVyUmVzcG9uc2VTdGF0ZSIsInNldFNlcnZlclJlc3BvbnNlU3RhdGUiLCJjdXJyZW50VXJsIiwiVVJMU2VhcmNoUGFyYW1zIiwicXVlcnlQYXJhbXNDb2RlIiwicXVlcnlQYXJhbXNFcnJvciIsImtleXMiLCJ0b2tlbiIsIm1lcmdlZFByb3BzQW5kU3RhdGVPcHRpb25zIiwiX2lubmVyIiwic2VydmVyUmVzcG9uc2VQcm9wcyIsImVtYWlsIiwiY2xpZW50X2lkIiwicHJvbXB0VHlwZSIsIkdvb2dsZUF1dGgiLCJfcHJvdmlkZXJQcm9wcyJdLCJtYXBwaW5ncyI6IjJCQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQTBEZixPQXJEQUYsRUFBb0JRLEVBQUlGLEVBR3hCTixFQUFvQlMsRUFBSVYsRUFHeEJDLEVBQW9CVSxFQUFJLFNBQVNSLEVBQVNTLEVBQU1DLEdBQzNDWixFQUFvQmEsRUFBRVgsRUFBU1MsSUFDbENHLE9BQU9DLGVBQWViLEVBQVNTLEVBQU0sQ0FBRUssWUFBWSxFQUFNQyxJQUFLTCxLQUtoRVosRUFBb0JrQixFQUFJLFNBQVNoQixHQUNYLG9CQUFYaUIsUUFBMEJBLE9BQU9DLGFBQzFDTixPQUFPQyxlQUFlYixFQUFTaUIsT0FBT0MsWUFBYSxDQUFFQyxNQUFPLFdBRTdEUCxPQUFPQyxlQUFlYixFQUFTLGFBQWMsQ0FBRW1CLE9BQU8sS0FRdkRyQixFQUFvQnNCLEVBQUksU0FBU0QsRUFBT0UsR0FFdkMsR0FEVSxFQUFQQSxJQUFVRixFQUFRckIsRUFBb0JxQixJQUMvQixFQUFQRSxFQUFVLE9BQU9GLEVBQ3BCLEdBQVcsRUFBUEUsR0FBOEIsaUJBQVZGLEdBQXNCQSxHQUFTQSxFQUFNRyxXQUFZLE9BQU9ILEVBQ2hGLElBQUlJLEVBQUtYLE9BQU9ZLE9BQU8sTUFHdkIsR0FGQTFCLEVBQW9Ca0IsRUFBRU8sR0FDdEJYLE9BQU9DLGVBQWVVLEVBQUksVUFBVyxDQUFFVCxZQUFZLEVBQU1LLE1BQU9BLElBQ3RELEVBQVBFLEdBQTRCLGlCQUFURixFQUFtQixJQUFJLElBQUlNLEtBQU9OLEVBQU9yQixFQUFvQlUsRUFBRWUsRUFBSUUsRUFBSyxTQUFTQSxHQUFPLE9BQU9OLEVBQU1NLElBQVFDLEtBQUssS0FBTUQsSUFDOUksT0FBT0YsR0FJUnpCLEVBQW9CNkIsRUFBSSxTQUFTMUIsR0FDaEMsSUFBSVMsRUFBU1QsR0FBVUEsRUFBT3FCLFdBQzdCLFdBQXdCLE9BQU9yQixFQUFnQixTQUMvQyxXQUE4QixPQUFPQSxHQUV0QyxPQURBSCxFQUFvQlUsRUFBRUUsRUFBUSxJQUFLQSxHQUM1QkEsR0FJUlosRUFBb0JhLEVBQUksU0FBU2lCLEVBQVFDLEdBQVksT0FBT2pCLE9BQU9rQixVQUFVQyxlQUFlMUIsS0FBS3VCLEVBQVFDLElBR3pHL0IsRUFBb0JrQyxFQUFJLEdBSWpCbEMsRUFBb0JBLEVBQW9CbUMsRUFBSSxHLGdCQ2xGckRoQyxFQUFPRCxRQUFVa0MsUUFBUSxVLHkvRENrQ2xCLFNBQVNDLEVBQWVDLEdBQ25CLElBQUFDLEVBQXdCRCxFQUFLLE1BdEJsQyxTQUFvQ0UsRUFBZ0JDLEcsMEZBQ2pDLFNBQU1DLE1BQU1GLEVBQVEsQ0FDdENHLE9BQVEsT0FDUkMsUUFBUyxDQUNMLGVBQWdCLG9CQUVwQkMsS0FBTUMsS0FBS0MsVUFBVU4sTSxPQUV6QixNQUFPLENBQVAsRUFQc0IsU0FPWE8sZ0JBZ0JYQyxDQUZnQ1gsRUFBSyxPQUNYLENBQUVDLEtBQUksRUFBRVcsTUFERlosRUFBSyxRQUdoQ2EsTUFBSyxTQUFDQyxHQUVFLGlCQUFrQkEsRUFLbkJkLEVBQU1lLGlCQUFpQixDQUNuQkMsWUFBYUYsRUFBS0csZUFMdEJqQixFQUFNZSxpQkFBaUIsQ0FDbkJHLE1BQU8seUNBU2xCQyxPQUFNLFNBQUFDLEdBQ0hwQixFQUFNZSxpQkFBaUIsQ0FDbkJHLE1BQU9FLEVBQUlDLGFBaUJwQixTQUFTQyxJQUNaLFFBQVNDLE9BQU9DLGFBQWFDLFFBQVEsZUFVbEMsU0FBU0MsSUFDWkgsT0FBT0MsYUFBYUcsV0FBVyxlQU81QixTQUFTQyxJQUNaLE9BQU9MLE9BQU9DLGFBQWFDLFFBQVEsZUFtQ2hDLFNBQVNJLEVBQW1CQyxHQUMvQixJQUFJQyxFQUFrQixHQU10QixPQUxHRCxJQUNDQyxFQUFrQixDQUNkLGtCQUFtQkQsSUFHcEIsRUFBUCxLQUNPQyxHQUFlLENBQ2xCLGVBQWdCLGlCQUFVSCxPQUszQixTQUFTSSxJQUNaLElBQU1DLEVBQWtCQyxTQUFTQyxTQUFTQyxLQUMxQyxHQUFHRixTQUFTQyxTQUFTRSxPQUFRLENBQ3pCLElBQU1DLEVBQVlMLEVBQWdCTSxVQUFVLEVBQUdOLEVBQWdCTyxRQUFRLE1BQ3ZFakIsT0FBT2tCLFFBQVFDLGFBQWEsR0FBSVIsU0FBU1MsTUFBT0wsSUF3Q2pELFNBQVNNLEVBQWNDLEVBQWtCQyxFQUFzQkMsR0FDbEUsSUFBSUMsRUFBTSxVQWhMa0Msc0NBZ0xDLEtBSzdDLE9BSkFBLEdBQU8sb0JBQWFILEdBQ3BCRyxHQUFPLDRCQUNQQSxHQUFPLHlCQUFrQkYsR0FDekJFLEdBQU8seUJBQWtCRCxHQUNsQjNDLE1BQU00QyxFQUFLLENBQUUzQyxPQUFRLFNBQ3ZCUSxNQUFLLFNBQUFDLEdBQ0YsT0FBT0EsRUFBS0osT0FBT0csTUFBSyxTQUFBQyxHQUNwQixHQUFJQSxFQUFLSSxNQUNMLE1BQU0sSUFBSStCLE1BQU1uQyxFQUFLSSxPQUdyQixPQURBSyxPQUFPQyxhQUFhMEIsUUFBUSxjQUFlcEMsRUFBS0csY0FDekNILEVBQUtHLG1CQUl2QkUsT0FBTSxTQUFBQyxHQUVILE1BREErQixRQUFRQyxNQUFNaEMsR0FDUixJQUFJNkIsTUFBTSxxQyxJQ3pNaEJJLEUsaUJBQVosU0FBWUEsR0FDUix1RUFESixDQUFZQSxNQUEwQixLQW9EdEMsaUJBUUksV0FBWUMsRUFBK0JDLEdBQTNDLFdBMERPLEtBQUFDLFNBQVcsU0FBQ0MsR0FDZixJQUFHLEVBQUtDLGtCQUdKLE1BQU0sSUFBSUMsZUFBZSxnRUFGekJwQyxPQUFPWSxTQUFTeUIsUUFBUSxFQUFLRixvQkEzRGpDRyxLQUFLUCxPQUFTQSxFQUNkTyxLQUFLTixVQUFZQSxFQStEekIsT0F2REksc0JBQVcsZ0NBQWlCLEMsSUFBNUIsV0FDSSxPQUFPTSxLQUFLQyxvQixJQUdoQixTQUE2Qi9FLEdBQ3pCOEUsS0FBS0MsbUJBQXFCL0UsRyxnQ0FJdkIsWUFBQWdGLDhCQUFQLFdBQ1UsSUFXRmYsRUFYRSxFQVNGYSxLQUFLUCxPQVJMLElBQUFVLGtCQUFVLElBQUcsWUFBUyxFQUN0QixJQUFBQyw0QkFBb0IsSUFBRyxHQUFJLEVBQzNCLElBQUFDLG9CQUFZLElBQUcsU0FBTSxFQUNyQixJQUFBQyxhQUFLLElBQUcsT0FBSSxFQUNaQyxFQUFXLGNBQ1h2QixFQUFRLFdBQ1J3QixFQUFTLFlBQ1RDLEVBQU0sU0FFSkMsRUFBU2xCLEVBQTJCbUIsc0JBRTFDeEIsRUFBTSxVQUFHdUIsRUFBTSxrQkFBVVYsS0FBS04sVUFBUyxLQUN2Q1AsRUFBTWdCLEVBQWEsVUFBR2hCLEVBQUcsdUJBQWVnQixFQUFVLEtBQU1oQixFQUN4REEsRUFBTSxVQUFHQSxFQUFHLGtDQUEwQmlCLEVBQW9CLEtBQzFEakIsRUFBTSxVQUFHQSxFQUFHLHlCQUFpQmtCLEVBQVksS0FDekNsQixFQUFNbUIsRUFBUSxVQUFHbkIsRUFBRyxpQkFBU21CLEVBQUssS0FBTW5CLEVBQ3hDQSxFQUFNcUIsRUFBWSxVQUFHckIsRUFBRyxzQkFBY3FCLEVBQVMsS0FBTXJCLEVBQ3JEQSxFQUFNc0IsRUFBUyxVQUFHdEIsRUFBRyxrQkFBVXNCLEVBQU0sS0FBTXRCLEVBQzNDQSxFQUFNLFVBQUdBLEVBQUcsd0JBQWdCb0IsRUFBVyxLQUN2Q3BCLEVBQU0sVUFBR0EsRUFBRyxxQkFBYUgsR0FDekJnQixLQUFLSCxrQkFBb0JWLEdBSWYsRUFBQXlCLGFBQWQsU0FBMkJDLEdBQ3ZCLElBQUlDLEVBQU0sR0FRVixPQVBBRCxFQUFPRSxLQUFJLFNBQUNoRSxFQUFPOUMsR0FDWDRHLEVBQU9HLE9BQVMsSUFBTS9HLEVBQ3RCNkcsR0FBTyxVQUFHL0QsR0FFVitELEdBQU8sVUFBRy9ELEVBQUssVUFHaEIrRCxHQVdmLEVBekVBLEcsK01DZ0JNRyxFQUF3QixHQUd4QkMsRUFBa0MsQ0FDcENDLGVBQWdCLFlBQ2hCQyxpQkFBa0IsWUFDbEJDLG1CQUFvQixZQUNwQkMsV0FBWSxPQUNaQyxPQUFRLG9CQUNSQyxRQUFTLFdBQ1RDLGFBQWMsTUFDZEMsZ0JBQWlCLFVBQ2pCQyxTQUFVLFFBa0NSQyxFQUFvQixJQUFNQyxjQVBJLENBQ2hDQyxjQUFlLGFBQ2ZDLFdBQVksYUFDWkMsVUFBVyxhQUNYOUUsaUJBQWtCLGVBS1QrRSxFQUFxQkwsRUFBa0JNLFNBcUJ2Q0MsRUFBcUJQLEVBQWtCUSxTQWN2Q0MsRUFBYyxTQUFDbEcsR0FFcEIsTUFJQUEsRUFBSyxZQUpMbUcsT0FBVyxJQUFHLEtBQUUsRUFDaEIsRUFHQW5HLEVBQUssYUFITG9HLE9BQVksSUFBRyxHQUFJLEVBQ25CQyxFQUVBckcsRUFBSyxRQURMLEVBQ0FBLEVBQUssY0FETHNHLE9BQWEsSUFBRyxHQUFLLEVBR25CNUIsRUFBUzZCLEVBQWM5QixhQUFhNEIsRUFBUTNCLFFBQzVDOEIsRUFBTyxJQUFJRCxFQUFjRixFQUFTM0IsR0FDeEM4QixFQUFLekMsZ0NBR0wsSUFBTTBDLEVBQVNMLEVBekJPLFNBQUNELEVBQXFCTSxHQUM1QyxPQUFHTixFQUNRLE9BQUtNLEdBQU0sQ0FBRUMsZ0JBQWlCLGNBQU9QLEVBQVcsT0FFcERNLEVBcUJ1QkUsQ0FBa0JSLEVBQWFwQixRQUFpQjZCLEVBTzlFLE9BTkc1RyxFQUFNa0IsT0FDTGlDLFFBQVFqQyxNQUFNLHVDQUFnQ2xCLEVBQU1rQixNQUFLLDhKQUk3RGMsSUFDTyxvQ0FDSCw0QkFBUTZFLE1BQU9KLEVBQVFLLFFBQVNOLEVBQUtoRCxTQUFVdUQsVUFBVyxVQUFHL0csRUFBTStHLFVBQVMsc0JBQXNCL0csRUFBTWdILFVBQ3RHVixHQUFpQnRHLEVBQU1rQixPQUFVLDZCQUFNbEIsRUFBTWtCLFNBNkJoRCxTQUFTK0YsRUFBYWpILEdBQ2xCLElBQUFrSCxFQUFZbEgsRUFBSyxTQUNsQixFQUEyRixxQkFBd0J5RixHQUFqSFksRUFBTyxVQUFFVCxFQUFVLGFBQUV1QixFQUFhLGdCQUFFeEIsRUFBYSxnQkFBRTVFLEVBQWdCLG1CQUFFcUcsRUFBZSxrQkFDdEYsRUFBZ0QscUJBQS9DQyxFQUFtQixLQUFFQyxFQUFzQixLQUM1Q0MsRUFBYSxJQUFJQyxnQkFBZ0JqRyxPQUFPWSxTQUFTRSxRQUNqRG9GLEVBQWtCRixFQUFXNUksSUFBSSxRQUNqQytJLEVBQW1CSCxFQUFXNUksSUFBSSxTQUN4QyxxQkFBVSxZQUNEMEgsR0FBV1QsR0FDWkEsRUFBVzVGLEVBQU1xRyxXQUV0QixDQUFDckcsRUFBTXFHLFVBQ1YscUJBQVUsV0FDSGMsSUFBa0IzSSxPQUFPbUosS0FBS1IsR0FBZXRDLFFBQVV3QyxHQUN0RHRILEVBQWVzSCxLQUVwQixDQUFDQSxFQUFxQkYsSUFDekIscUJBQVUsV0ZsS1AsSUFBMEJTLEdFbUt0QlQsYUFBYSxFQUFiQSxFQUFlbkcsZUFBZ0JNLE1GbktUc0csRUVvS0pULEVBQWNuRyxZRm5LdENPLE9BQU9DLGFBQWEwQixRQUFRLGNBQWUwRSxHRW9LcEN6RSxRQUFRQyxNQUFNLHVDQUNlLG1CQUFsQnVDLEdBQWlDeUIsR0FDeEN6QixHQUFjLE1BR3ZCLENBQUN3QixhQUFhLEVBQWJBLEVBQWVuRyxjQUVuQixJQUFJNkcsRUFBNkIsT0FDMUI3SCxFQUFNcUcsU0FDTkEsR0FFSHlCLEVBQ0Esa0JBQUM1QixFQUFXLEtBQ0psRyxFQUFLLENBQ1RtRyxZQUFhbkcsRUFBTW1HLFlBQ25CakYsTUFBT2lHLGFBQWEsRUFBYkEsRUFBZWpHLE1BQ3RCbUYsUUFBU3dCLEtBRWpCLEdBQUlWLGFBQWEsRUFBYkEsRUFBZWpHLE1BRWYsT0FEQWlDLFFBQVFqQyxNQUFNLDREQUFxRGlHLGFBQWEsRUFBYkEsRUFBZWpHLE1BQUssWUFDaEY0RyxFQUNKLEdBQUlMLElBQW9CbkcsSUFBYyxDQUV6QyxJQUVNeUcsRUFBdUMsQ0FDekNDLE1BSHFCVCxFQUFXNUksSUFBSSxVQUFZLEdBSWhEaUMsTUFIcUIyRyxFQUFXNUksSUFBSSxVQUFZLEdBSWhEc0IsS0FBTXdILEVBQ05RLFVBQVdqSSxFQUFNcUcsUUFBUXhELFNBQ3pCM0MsT0FBUUYsRUFBTUUsT0FDZGlILGNBQWVBLEVBQ2ZwRyxpQkFBa0JBLEdBT3RCLE9BTEFpQixJQUNJbUYsSUFBa0IzSSxPQUFPbUosS0FBS1IsR0FBZXRDLFFBQzdDeUMsRUFBdUJTLEdBRTNCNUUsUUFBUUMsTUFBTSxtQ0FDUDhELEVBQVdBLElBQWEsa0RBQzVCLE9BQUlRLEdBQ1B2RSxRQUFRakMsTUFBTSxrREFBMkN3RyxFQUFnQixZQUNsRUksR0FHSkEsRUErREosU0FBU2pDLEVBQVVELEVBQXNCUyxHQUM1QyxPQUFPLFNBQUM2QixHQUNBN0IsSUFBWUEsRUFBUS9CLFFBQ3BCc0IsRUFBVyxPQUNKUyxHQUFPLENBQ1YvQixPQUFRNEQsTUFXakIsSUFBTUMsRUFBYSxTQUFDbkksR0FDakIsTUFBb0MsbUJBQStCOEUsR0FBbEVxQyxFQUFhLEtBQUVwRyxFQUFnQixLQUNoQyxFQUFtQyxtQkFBa0JPLEtBQXBEOEYsRUFBZSxLQUFFekIsRUFBYSxLQUMvQixFQUF3QixxQkFBdkJVLEVBQU8sS0FBRVQsRUFBVSxLQUVwQndDLEVBQThCLENBQ2hDaEIsZ0JBQWUsRUFDZnpCLGNBQWEsRUFDYndCLGNBQWEsRUFDYnBHLGlCQUFnQixFQUNoQnNGLFFBQU8sRUFDUFQsV0FBVSxFQUNWQyxVQUFXQSxFQUFVRCxFQUFZUyxJQUVyQyxPQUNJLGtCQUFDUCxFQUFrQixDQUFDL0csTUFBT3FKLEdBQ3RCcEksRUFBTWdIIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDEpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwicmVhY3RcIik7IiwiLyoqIEBpbnRlcm5hbCAqL1xuaW1wb3J0IHtEaXNwYXRjaCwgU2V0U3RhdGVBY3Rpb24sIHVzZUVmZmVjdH0gZnJvbSBcInJlYWN0XCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVBheWxvYWQge1xuICAgIHJlYWRvbmx5IGNvZGU6IHN0cmluZztcbiAgICByZWFkb25seSBzY29wZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY29uc3QgR09PR0xFX09BVVRIMl9FWENIQU5HRV9UT0tFTl9VUkwgPSBcImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuXCI7XG5cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBpbnRlcmZhY2UgSUFwaVJlc3BvbnNlRGF0YSB7IHJlYWRvbmx5IGFjY2Vzc190b2tlbjogc3RyaW5nOyB9XG4vKiogQGludGVybmFsICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcG9zdFRvRXhjaGFuZ2VBcGlVcmwoYXBpVXJsOiBzdHJpbmcsIHBheWxvYWQ6IElQYXlsb2FkKTogUHJvbWlzZTxJQXBpUmVzcG9uc2VEYXRhPiB7XG4gICAgY29uc3QgcmVzOiBSZXNwb25zZSA9IGF3YWl0IGZldGNoKGFwaVVybCwge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksXG4gICAgfSk7XG4gICAgcmV0dXJuIHJlcy5qc29uKCk7XG59XG4vKiogQGludGVybmFsICovXG5leHBvcnQgaW50ZXJmYWNlIElTZXJ2ZXJSZXNwb25zZVN0YXRlIHsgcmVhZG9ubHkgYWNjZXNzVG9rZW4/OiBzdHJpbmc7IGVycm9yPzogc3RyaW5nfVxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGludGVyZmFjZSBJU2VydmVyUmVzcG9uc2VQcm9wcyB7XG4gICAgcmVhZG9ubHkgY29kZTogc3RyaW5nO1xuICAgIHJlYWRvbmx5IHNjb3BlOiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgYXBpVXJsOiBzdHJpbmc7XG4gICAgcmVzcG9uc2VTdGF0ZTogSVNlcnZlclJlc3BvbnNlU3RhdGU7XG4gICAgc2V0UmVzcG9uc2VTdGF0ZTogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248SVNlcnZlclJlc3BvbnNlU3RhdGU+Pjtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXJ2ZXJSZXNwb25zZShwcm9wczogSVNlcnZlclJlc3BvbnNlUHJvcHMpOiB2b2lkIHtcbiAgICBjb25zdCB7IGNvZGUsIGFwaVVybCwgc2NvcGUgfSA9IHByb3BzO1xuICAgIGNvbnN0IHBheWxvYWQ6IElQYXlsb2FkID0geyBjb2RlLCBzY29wZSB9O1xuICAgIHBvc3RUb0V4Y2hhbmdlQXBpVXJsKGFwaVVybCwgcGF5bG9hZClcbiAgICAgICAgLnRoZW4oKGRhdGE6IElBcGlSZXNwb25zZURhdGEpID0+IHtcbiAgICAgICAgICAgIC8vIHVwZGF0ZSByZXNwb25zZVN0YXRlIGFjY2Vzc1Rva2VuXG4gICAgICAgICAgICBpZighKFwiYWNjZXNzX3Rva2VuXCIgaW4gZGF0YSkpIHtcbiAgICAgICAgICAgICAgICBwcm9wcy5zZXRSZXNwb25zZVN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IFwic28gYWNjZXNzX3Rva2VuIGluIHJlc3BvbnNlIGRhdGEhXCIsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHByb3BzLnNldFJlc3BvbnNlU3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbjogZGF0YS5hY2Nlc3NfdG9rZW4sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICBwcm9wcy5zZXRSZXNwb25zZVN0YXRlKHtcbiAgICAgICAgICAgICAgICBlcnJvcjogZXJyLm1lc3NhZ2UsXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBmdW5jdGlvbiBzdG9yZUFjY2Vzc1Rva2VuKHRva2VuOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiYWNjZXNzVG9rZW5cIiwgdG9rZW4pO1xufVxuXG4vKipcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqICBpZihpc0xvZ2dlZEluKCkpIHsgLy8gcmV0dXJucyB0cnVlIGlzIGFjY2Vzc1Rva2VuIGV4aXN0cyBpbiBMb2NhbFN0b3JhZ2VcbiAqICAgICAgLy8gdXNlciBsb2dnZWQgY29kZS4uLlxuICogIH1cbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNMb2dnZWRJbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISF3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJhY2Nlc3NUb2tlblwiKTtcbn1cblxuLyoqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiAgbG9nT3V0T0F1dGhVc2VyKCkgLy8gcmVtb3ZlcyB0aGUgYWNjZXNzVG9rZW4gZnJvbSBMb2NhbFN0b3JhZ2VcbiAqIGBgYFxuICogQHJldHVybiB2b2lkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsb2dPdXRPQXV0aFVzZXIoKTogdm9pZCB7XG4gICAgd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiYWNjZXNzVG9rZW5cIik7XG59XG5cbi8qKlxuICogQGRlc2NyaXB0aW9uIEdldCB0aGUgc3RvcmVkIGFjY2Vzc1Rva2VuXG4gKiBAcmV0dXJuIFRoZSBBY2Nlc3MgVG9rZW4gb3Igbm9uZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWNjZXNzVG9rZW4oKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgcmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImFjY2Vzc1Rva2VuXCIpO1xufVxuXG4vKipcbiAqIEBkZXNjcmlwdGlvbiBXYXJuaW5nOiBQbGVhc2UgbWFrZSBzdXJlIHRoYXQgYXMgb2YgdmVyc2lvbiBgMC4wLjIzYCB3ZSBoYXZlIHJlbW92ZWRcbiAqIHRoZSBgYXBwbGljYXRpb24vanNvbmAgY29udGVudCB0eXBlIGhlYWRlcnMgZnJvbSB0aGlzIGZ1bmN0aW9uLiBUaGlzIG1heSBjYXVzZSBhbiBpc3N1ZVxuICogaWYgeW91IG9yaWdpbmFsbHkgZGlkbid0IGNvbnN0cnVjdCB5b3VyIHJlcXVlc3QgY29udGVudCB0eXBlIGhlYWRlcnMgd2l0aCBgYXBwbGljYXRpb24vanNvbmAuXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiAgZmV0Y2godXJsLCB7XG4gKiAgICAgIGhlYWRlcnM6IGNyZWF0ZU9BdXRoSGVhZGVycygpLFxuICogIH0pXG4gKiBgYGBcbiAqXG4gKiBJZiB5b3UgcmVxdWlyZSB5b3VyIHNlcnZlciB0byBoYW5kbGUgYXV0aGVudGljYXRpbmcgbXVsdGlwbGUgdXNlcnMgYWNyb3NzIG1hbnkgcmVzb3VyY2VzXG4gKiAob3IgdGFibGVzKSB0aGVuIHBhc3MgaW4gdGhlIG5hbWUgb2YgdGhlIHJlc291cmNlLCBmb3IgRXhhbXBsZTpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqICBmZXRjaCh1cmwsIHtcbiAqICAgICAgaGVhZGVyczogY3JlYXRlT0F1dGhIZWFkZXJzKFwidXNlcnNcIiksXG4gKiAgfSlcbiAqIGBgYFxuICpcbiAqICBXaXRoIHRoZSByZXNvdXJjZSB2YWx1ZSwgdGhlIGZvbGxvd2luZyBoZWFkZXJzIGFyZSBjb25zdHJ1Y3RlZDpcbiAqXG4gKiAgQGV4YW1wbGVcbiAqICBgYGBcbiAqICB7XG4gKiAgICBcIlgtQXV0aC1Ub2tlblwiIDogXCI8VE9LRU4+XCIsXG4gKiAgICBcIlgtQXV0aC1SZXNvdXJjZVwiOiBcInVzZXJzXCIsXG4gKiAgfVxuICogIGBgYFxuICogQHBhcmFtIHJlc291cmNlIE9wdGlvbmFsIHJlc291cmNlIG5hbWUgdG8gbG9vayB1cCBvbiB0aGUgc2VydmVyXG4gKiBAcmV0dXJuIE9iamVjdHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU9BdXRoSGVhZGVycyhyZXNvdXJjZT86IHN0cmluZyk6IHsgW2s6IHN0cmluZ106IHN0cmluZyB9IHtcbiAgICBsZXQgcmVzb3VyY2VIZWFkZXJzID0ge307XG4gICAgaWYocmVzb3VyY2UpIHtcbiAgICAgICAgcmVzb3VyY2VIZWFkZXJzID0ge1xuICAgICAgICAgICAgXCJYLUF1dGgtUmVzb3VyY2VcIjogcmVzb3VyY2UsXG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucmVzb3VyY2VIZWFkZXJzLFxuICAgICAgICBcIlgtQXV0aC1Ub2tlblwiOiBgQmVhcmVyICR7Z2V0QWNjZXNzVG9rZW4oKX1gLFxuICAgIH1cbn1cblxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZU9BdXRoUXVlcnlQYXJhbXMoKTogdm9pZCB7XG4gICAgY29uc3QgY3VycmVudExvY2F0aW9uID0gZG9jdW1lbnQubG9jYXRpb24uaHJlZjtcbiAgICBpZihkb2N1bWVudC5sb2NhdGlvbi5zZWFyY2gpIHtcbiAgICAgICAgY29uc3QgY2xlYW5fdXJpID0gY3VycmVudExvY2F0aW9uLnN1YnN0cmluZygwLCBjdXJyZW50TG9jYXRpb24uaW5kZXhPZihcIj9cIikpO1xuICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sIGRvY3VtZW50LnRpdGxlLCBjbGVhbl91cmkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEZ1bmN0aW9uIHRvIGV4Y2hhbmdlIGEgcmVmcmVzaCB0b2tlbiBmb3IgYW4gYWNjZXNzIHRva2VuICYgc2V0cyB0aGUgYWNjZXNzXG4gKiB0b2tlbiBpbnRvIGxvY2FsIHN0b3JhZ2UuLlxuICogQGV4YW1wbGVcbiAqIGBgYFxuICogIGV4Y2hhbmdlVG9rZW4oQ0xJRU5UX0lELCBSRUZSRVNIX1RPS0VOLCBDTElFTlRfU0VDUkVUKVxuICogIC50aGVuKGFjY2Vzc1Rva2VuID0+IHtcbiAqICAgICAgIGNvbnNvbGUubG9nKGFjY2Vzc1Rva2VuKSAvLyB5b3VyIGFjY2VzcyB0b2tlbi4uLlxuICogICB9KTtcbiAqIGBgYFxuICogSWYgeW91IHJlcXVpcmUgYW4gYWNjZXNzIHRva2VuIHRvIHJ1biB5b3VyIGUyZSB0ZXN0cyB0aGVuIGBleGNoYW5nZVRva2VuYCB3aWxsIHNldCBhbmQgcmV0dXJuIGEgbmV3IGFjY2VzcyB0b2tlbi5cbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqICAgICBDeXByZXNzLkNvbW1hbmRzLmFkZChcImxvZ2luU1NPXCIsICAob3ZlcnJpZGVzID0ge30pID0+IHtcbiAqICAgICAgIEN5cHJlc3MubG9nKHtcbiAqICAgICAgICAgICBcIm5hbWVcIjogXCJsb2dpblNTT1wiLFxuICogICAgICAgfSk7XG4gKiAgICAgICBpZighZ2V0QWNjZXNzVG9rZW4oKSkge1xuICogICAgICAgICAgIGV4Y2hhbmdlVG9rZW4oQ0xJRU5UX0lELCBSRUZSRVNIX1RPS0VOLCBDTElFTlRfU0VDUkVUKVxuICogICAgICAgICAgIC50aGVuKGFjY2Vzc1Rva2VuID0+IHtcbiAqICAgICAgICAgICAgICAgY3kucmVxdWVzdCh7XG4gKiAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICogICAgICAgICAgICAgICAgICAgdXJsOiBgJHtBUElfVVJMfS9zdGFmZmAsXG4gKiAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBjcmVhdGVPQXV0aEhlYWRlcnMoKSxcbiAqICAgICAgICAgICAgICAgfSk7XG4gKiAgICAgICAgICAgfSk7XG4gKiAgICAgICB9XG4gKiAgIH0pO1xuICogYGBgXG4gKiBAcGFyYW0gY2xpZW50SWQgR29vZ2xlIE9BdXRoIENsaWVudCBJRFxuICogQHBhcmFtIHJlZnJlc2hUb2tlbiBSZWZyZXNoIFRva2VuIChVc2UgR29vZ2xlIE9hdXRoIFBsYXlncm91bmQgdG8gZ2VuZXJhdGUgYSByZWZyZXNoIHRva2VuKVxuICogU2VlOiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9vYXV0aHBsYXlncm91bmQvXG4gKiBAcGFyYW0gY2xpZW50U2VjcmV0IEdvb2dsZSBBcGkncyBDbGllbnQgU2VjcmV0XG4gKiBAcmV0dXJuIFByb21pc2U8U3RyaW5nPiBUaGUgc3RyaW5nIGlzIHRoZSBuZXcgYWNjZXNzIHRva2VuIGFsc28gc2V0IGluIGxvY2FsIHN0b3JhZ2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGV4Y2hhbmdlVG9rZW4oY2xpZW50SWQ6IHN0cmluZywgcmVmcmVzaFRva2VuOiBzdHJpbmcsIGNsaWVudFNlY3JldDogc3RyaW5nKTogUHJvbWlzZTxTdHJpbmc+IHtcbiAgICBsZXQgdXJsID0gYCR7R09PR0xFX09BVVRIMl9FWENIQU5HRV9UT0tFTl9VUkx9P2A7XG4gICAgdXJsICs9IGBjbGllbnRfaWQ9JHtjbGllbnRJZH1gO1xuICAgIHVybCArPSBgJmdyYW50X3R5cGU9cmVmcmVzaF90b2tlbmA7XG4gICAgdXJsICs9IGAmcmVmcmVzaF90b2tlbj0ke3JlZnJlc2hUb2tlbn1gO1xuICAgIHVybCArPSBgJmNsaWVudF9zZWNyZXQ9JHtjbGllbnRTZWNyZXR9YDtcbiAgICByZXR1cm4gZmV0Y2godXJsLCB7IG1ldGhvZDogXCJQT1NUXCIsIH0pXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEuanNvbigpLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImFjY2Vzc1Rva2VuXCIsIGRhdGEuYWNjZXNzX3Rva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuYWNjZXNzX3Rva2VuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoZXJyKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIHJlZnJlc2ggYWNjZXNzIHRva2VuXCIpO1xuICAgICAgICB9KTtcbn1cbiIsIi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBlbnVtIEdvb2dsZUFQSUNvbm5lY3Rpb25TdHJpbmdzIHtcbiAgICBHT09HTEVfT0FVVEhfRU5EUE9JTlQgPSBcImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi92Mi9hdXRoXCIsXG59XG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0IHR5cGUgVHlwZVByb21wdCA9IFwiY29uc2VudFwiIHwgXCJzZWxlY3RfYWNjb3VudFwiO1xuLyoqIEBwdWJsaWMgKi9cbmludGVyZmFjZSBJQXV0aG9yaXphdGlvbkJhc2Uge1xuICAgIC8qKiBUaGlzIGlzIHlvdXIgY2xpZW50IElEICovXG4gICAgY2xpZW50SWQ6IHN0cmluZztcbiAgICAvKiogV2hlcmUgeW91IFJlYWN0IGFwcCBzaG91bGQgcmVkaXJlY3QgdG8gaWYgdXNlciBoYXMgc3VjY2Vzc2Z1bGx5IGxvZ2dlZCBpbiAqKi9cbiAgICByZWRpcmVjdFVyaTogc3RyaW5nO1xuICAgIC8qKiBCeSBkZWZhdWx0IHRoaXMgaXMgc2V0IHRvICpjb2RlKiAqL1xuICAgIHJlc3BvbnNlVHlwZT86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBJbmRpY2F0ZXMgaWYgdGhlIGFwaSAqKmFwaVVybCoqIHtAbGluayBJR29vZ2xlQnV0dG9ufSBjYW4gcmVmcmVzaCB0b2tlbnMgb24gdGhlIHVzZXInc1xuICAgICAqIGJlaGFsZi4gVGhlIGRlZmF1bHQgdmFsdWUgaXMgKm9ubGluZSogYnV0IGlmIHlvdXIgYmFja2VuZCBhcGkgd2lsbCByZWZyZXNoIHRoZSB0b2tlbiB0aGVuXG4gICAgICogeW91IG11c3QgcGFzcyBpbiBhIHN0cmluZyB2YWx1ZSBvZiAqb2ZmbGluZSogKFRoaXMgaXMgcmVjb21tZW5kZWQgZm9yIHJlYWN0IGFwcHMgY29ubmVjdGVkXG4gICAgICogdG8gYSBSRVNUIGFwaSBiYWNrZW5kKS5cbiAgICAgKi9cbiAgICBhY2Nlc3NUeXBlPzogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIFRoaXMgb3B0aW9uIGlzIGN1cnJlbnRseSB1bmF2YWlsYWJsZSBidXQgd2lsbCBiZSBpbiBhIGFkZGVkIGluIGEgZnV0dXJlIHZlcnNpb24sXG4gICAgICogVE9ETyAtIFNlZSBodHRwczovL2dpdGh1Yi5jb20vam9lZ2FzZXdpY3ovcmVhY3QtZ29vZ2xlLW9hdXRoMi4wL2lzc3Vlcy8zXG4gICAgICogKi9cbiAgICBzdGF0ZT86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBEZWZhdWx0ZWQgdG8gdHJ1ZS4gQW55IGV4dHJhIHNjb3BlcyB0aGUgbG9nZ2VkIGluIHVzZXIgcHJldmlvdXNseSBncmFudGVkXG4gICAgICogd2lsbCBiZSBhdmFpbGFibGUgd2l0aGluIHRoZSBuZXcgYWNjZXNzIHRva2VuLlxuICAgICAqICovXG4gICAgaW5jbHVkZUdyYW50ZWRTY29wZXM/OiBib29sZWFuO1xuICAgIC8qKiBOb3QgcmVxdWlyZWQsIG9wdGlvbmFsLiBGb3IgcHJlZmlsbGluZyBlbWFpbCBmaWVsZHMgKi9cbiAgICBsb2dpbkhpbnQ/OiBzdHJpbmc7XG4gICAgLyoqXG4gICAgICogTm90IHJlcXVpcmVkLCBvcHRpb25hbC4gQSBzcGFjZS1kZWxpbWl0ZWQsIGNhc2Utc2Vuc2l0aXZlIGxpc3Qgb2YgcHJvbXB0cyB0b1xuICAgICAqIHByZXNlbnQgdGhlIHVzZXIuIElmIHlvdSBkb24ndCBzcGVjaWZ5IHRoaXMgcGFyYW1ldGVyLCB0aGUgdXNlciB3aWxsIGJlIHByb21wdGVkXG4gICAgICogb25seSB0aGUgZmlyc3QgdGltZSB5b3VyIHByb2plY3QgcmVxdWVzdHMgYWNjZXNzLiBWYWxpZCB2YWx1ZXM6XG4gICAgICogIGNvbnNlbnQgLSBQcm9tcHQgdGhlIHVzZXIgZm9yIGNvbnNlbnQuXG4gICAgICogIHNlbGVjdF9hY2NvdW50IC0gUHJvbXB0IHRoZSB1c2VyIHRvIHNlbGVjdCBhbiBhY2NvdW50LlxuICAgICAqICovXG4gICAgcHJvbXB0PzogVHlwZVByb21wdDtcbn1cbi8qKiBAcHVibGljICovXG5leHBvcnQgaW50ZXJmYWNlIElBdXRob3JpemF0aW9uT3B0aW9ucyBleHRlbmRzIElBdXRob3JpemF0aW9uQmFzZSB7XG4gICAgc2NvcGVzOiBBcnJheTxzdHJpbmc+O1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGludGVyZmFjZSBJQXV0aG9yaXphdGlvbiB7XG4gICAgcGFyYW1zOiBJQXV0aG9yaXphdGlvbk9wdGlvbnM7XG4gICAgLyoqIFNldCB0byAgYFtcIm9wZW5pZFwiLCBcInByb2ZpbGVcIl1gIGJ5IGRlZmF1bHQgKiovXG4gICAgc2NvcGVzU3RyOiBzdHJpbmc7XG59XG4vKiogQGludGVybmFsICovXG5leHBvcnQgY2xhc3MgQXV0aG9yaXphdGlvbiBpbXBsZW1lbnRzIElBdXRob3JpemF0aW9uIHtcblxuICAgIHByaXZhdGUgX2dvb2dsZVJlZGlyZWN0VVJMPzogc3RyaW5nO1xuXG4gICAgcHVibGljIHBhcmFtczogSUF1dGhvcml6YXRpb25PcHRpb25zO1xuXG4gICAgcHVibGljIHNjb3Blc1N0cjogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IocGFyYW1zOiBJQXV0aG9yaXphdGlvbk9wdGlvbnMsIHNjb3Blc1N0cjogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xuICAgICAgICB0aGlzLnNjb3Blc1N0ciA9IHNjb3Blc1N0cjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBAcHJvcGVydHkgZ29vZ2xlUmVkaXJlY3RVUkwgQWNjZXNzIHRoZSB1cmwgZm9yIHRoZSBpbml0aWFsXG4gICAgICogYnJvd3NlciBjYWxsIHRvIEdvb2dsZSdzIE9BdXRoIDIuMCBzZXJ2ZXIuIFVzZWZ1bCBmb3IgZGVidWdnaW5nLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgZ29vZ2xlUmVkaXJlY3RVUkwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9nb29nbGVSZWRpcmVjdFVSTDtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IGdvb2dsZVJlZGlyZWN0VVJMKHZhbHVlOiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fZ29vZ2xlUmVkaXJlY3RVUkwgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHVibGljIGNyZWF0ZUF1dGhvcml6YXRpb25SZXF1ZXN0VVJMKCk6IHZvaWQge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBhY2Nlc3NUeXBlID0gXCJvZmZsaW5lXCIsXG4gICAgICAgICAgICBpbmNsdWRlR3JhbnRlZFNjb3BlcyA9IHRydWUsXG4gICAgICAgICAgICByZXNwb25zZVR5cGUgPSBcImNvZGVcIixcbiAgICAgICAgICAgIHN0YXRlID0gbnVsbCxcbiAgICAgICAgICAgIHJlZGlyZWN0VXJpLFxuICAgICAgICAgICAgY2xpZW50SWQsXG4gICAgICAgICAgICBsb2dpbkhpbnQsXG4gICAgICAgICAgICBwcm9tcHQsXG4gICAgICAgIH0gPSB0aGlzLnBhcmFtcztcbiAgICAgICAgY29uc3QgZG9tYWluID0gR29vZ2xlQVBJQ29ubmVjdGlvblN0cmluZ3MuR09PR0xFX09BVVRIX0VORFBPSU5UO1xuICAgICAgICBsZXQgdXJsOiBzdHJpbmc7XG4gICAgICAgIHVybCA9IGAke2RvbWFpbn0/c2NvcGU9JHt0aGlzLnNjb3Blc1N0cn0mYDtcbiAgICAgICAgdXJsID0gYWNjZXNzVHlwZSA/IGAke3VybH1hY2Nlc3NfdHlwZT0ke2FjY2Vzc1R5cGV9JmAgOiB1cmw7XG4gICAgICAgIHVybCA9IGAke3VybH1pbmNsdWRlX2dyYW50ZWRfc2NvcGVzPSR7aW5jbHVkZUdyYW50ZWRTY29wZXN9JmA7XG4gICAgICAgIHVybCA9IGAke3VybH1yZXNwb25zZV90eXBlPSR7cmVzcG9uc2VUeXBlfSZgO1xuICAgICAgICB1cmwgPSBzdGF0ZSA/IGAke3VybH1zdGF0ZT0ke3N0YXRlfSZgIDogdXJsO1xuICAgICAgICB1cmwgPSBsb2dpbkhpbnQgPyBgJHt1cmx9bG9naW5faGludD0ke2xvZ2luSGludH0mYCA6IHVybDtcbiAgICAgICAgdXJsID0gcHJvbXB0ID8gYCR7dXJsfXByb21wdD0ke3Byb21wdH0mYCA6IHVybDtcbiAgICAgICAgdXJsID0gYCR7dXJsfXJlZGlyZWN0X3VyaT0ke3JlZGlyZWN0VXJpfSZgO1xuICAgICAgICB1cmwgPSBgJHt1cmx9Y2xpZW50X2lkPSR7Y2xpZW50SWR9YDtcbiAgICAgICAgdGhpcy5nb29nbGVSZWRpcmVjdFVSTCA9IHVybDtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGVTY29wZXMoc2NvcGVzOiBBcnJheTxzdHJpbmc+KTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHN0ciA9IFwiXCI7XG4gICAgICAgIHNjb3Blcy5tYXAoKHNjb3BlLCBpKSA9PiB7XG4gICAgICAgICAgICBpZiAoc2NvcGVzLmxlbmd0aCAtIDEgPT09IGkpIHtcbiAgICAgICAgICAgICAgICBzdHIgKz0gYCR7c2NvcGV9YDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3RyICs9IGAke3Njb3BlfSUyMGA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc3RyO1xuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgcmVkaXJlY3QgPSAoZTogYW55KTogdm9pZCA9PiB7XG4gICAgICAgIGlmKHRoaXMuZ29vZ2xlUmVkaXJlY3RVUkwpIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKHRoaXMuZ29vZ2xlUmVkaXJlY3RVUkwpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJFcnJvciBjcmVhdGluZyByZWRpcmVjdCB1cmwgdG8gR29vZ2xlJ3MgYXV0aG9yaXphdGlvbiBzZXJ2ZXJcIik7XG4gICAgICAgIH1cbiAgICB9XG59IiwiaW1wb3J0IHtkZWZhdWx0IGFzIFJlYWN0LCBEaXNwYXRjaCwgU2V0U3RhdGVBY3Rpb24sIHVzZUNvbnRleHQsIHVzZUVmZmVjdCwgdXNlU3RhdGV9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHtcbiAgICBBdXRob3JpemF0aW9uLFxuICAgIElBdXRob3JpemF0aW9uT3B0aW9ucywgVHlwZVByb21wdCxcbn0gZnJvbSBcIi4vYXV0aG9yaXphdGlvblwiO1xuaW1wb3J0IHtcbiAgICBzZXJ2ZXJSZXNwb25zZSxcbiAgICBzdG9yZUFjY2Vzc1Rva2VuLFxuICAgIGlzTG9nZ2VkSW4sXG4gICAgcmVtb3ZlT0F1dGhRdWVyeVBhcmFtcywgSVNlcnZlclJlc3BvbnNlU3RhdGUsIElTZXJ2ZXJSZXNwb25zZVByb3BzLFxufSBmcm9tIFwiLi9hcGlVdGlsc1wiO1xuXG4vKiogQHB1YmxpYyAqL1xuZXhwb3J0IGludGVyZmFjZSBJR29vZ2xlQnV0dG9uIHtcbiAgICAvKiogUGxhY2Vob2xkZXIgaW1hZ2UgZGlzcGxheWVkIG5leHQgdG8gYnV0dG9uIHRleHQuIFRoZSBwbGFjZWhvbGRlciBwcm9wIGhhcyBubyBlZmZlY3QgaWYgcGxhY2Vob2xkZXIgaXMgc2V0IHRvIGZhbHNlICovXG4gICAgcmVhZG9ubHkgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gICAgLyoqIFJlbW92ZSBkZWZhdWx0IHN0eWxlcy5cbiAgICAgKiAgVG8gU3R5bGUgdGhlIDxidXR0b24+IGVsZW1lbnQgd2l0aCBDU1MsIHVzZSBgZ29vZ2xlLW9hdXRoLWJ0bmAuIEZvciBleGFtcGxlOlxuICAgICAqICBgYGBcbiAgICAgKiAgLmdvb2dsZS1vYXV0aC1idG4ge1xuICAgICAqICAgICAgY29sb3I6IHJlZDtcbiAgICAgKiAgICAgIGJhY2tncm91bmQtY29sb3I6IGxpbWU7XG4gICAgICogIH1cbiAgICAgKiAgYGBgXG4gICAgICogKHlvdSBjYW4gYWxzbyBwYXNzIHlvdXIgY3NzIHNlbGVjdG9ycyBkaXJlY3RseSB3aXRoIFJlYWN0cycgYGNsYXNzTmFtZWAgcHJvcClcbiAgICAgKiAqL1xuICAgIHJlYWRvbmx5IGRlZmF1bHRTdHlsZT86IGJvb2xlYW47XG4gICAgLyoqIFNlZSBJQXV0aG9yaXphdGlvblJlcXVlc3RQYXJhbXMgKi9cbiAgICByZWFkb25seSBvcHRpb25zOiBJQXV0aG9yaXphdGlvbk9wdGlvbnM7XG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5XG4gICAgICogQG9wdGlvbmFsXG4gICAgICogQSBSZWFjdCBjb21wb25lbnQgb3IgYW55IGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIFJlYWN0IGNvbXBvbmVudC5cbiAgICAgKiBUaGlzIHdvdWxkIG5vcm1hbGx5IGJlIHVzZWQgdG8gZGlzcGxheSBhIHByZWxvYWRlciB0byB0aGUgdXNlciB3aGlsc3RcbiAgICAgKiB0aGUgT0F1dGgyLjAgbG9naW4gc3RyYXRlZ3kgaXMgaW4gZmxpZ2h0LiBCeSBkZWZhdWx0IGEgYExvYWRpbmcuLi5gXG4gICAgICogbWVzc2FnZSB3aWxsIGJlIGRpc3BsYXllZC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYFxuICAgICAqIDxHb29nbGVCdXR0b25cbiAgICAgKiAgICBjYWxsYmFjaz17KCkgPT4gPD5cIkxvYWRpbmcuLi5cIjwvPn1cbiAgICAgKiAgICAvLyBvdGhlciBwcm9wcy4uLlxuICAgICAqIC8+XG4gICAgICogYGBgXG4gICAgICovXG4gICAgcmVhZG9ubHkgY2FsbGJhY2s/OiAoKSA9PiBSZWFjdC5SZWFjdEhUTUxFbGVtZW50PGFueT47XG4gICAgLyoqIFRoZSB1cmwgb2YgdGhlIGFwaSB0byBwZXJmb3JtIHRoZSBleGNoYW5nZSAqL1xuICAgIHJlYWRvbmx5IGFwaVVybDogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIE9wdGlvbmFsLiBEZWZhdWx0IHNldCB0byBmYWxzZS5cbiAgICAgKiBEaXNwbGF5IGFuIGVycm9yIHRvIHRoZSB1c2VyICh3aWxsIGJlIGRpc3BsYXllZCBpbiBhIGNoaWxkIGBkaXZgIGVsZW1lbnQpLlxuICAgICAqL1xuICAgIHJlYWRvbmx5IGRpc3BsYXlFcnJvcnM/OiBib29sZWFuO1xufVxuLyoqIEBpbnRlcm5hbCAqL1xudHlwZSBUeXBlQnV0dG9uU3R5bGVzID0geyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfTtcbi8qKiBAaW50ZXJuYWwgKi9cbnR5cGUgVHlwZUdvb2dsZUJ1dHRvbiA9IElHb29nbGVCdXR0b24gJiBSZWFjdC5CdXR0b25IVE1MQXR0cmlidXRlczxIVE1MQnV0dG9uRWxlbWVudD47XG4vKiogQGludGVybmFsICovXG5pbnRlcmZhY2UgSVNlcnZlclJlc3BvbnNlIHtcbiAgICByZWFkb25seSBlbWFpbD86IHN0cmluZztcbiAgICBlcnJvcj86IHN0cmluZztcbiAgICByZWFkb25seSBjb2RlOiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgc2NvcGU6IHN0cmluZztcbiAgICByZWFkb25seSBjbGllbnRfaWQ6IHN0cmluZztcbiAgICByZWFkb25seSBhcGlVcmw6IHN0cmluZztcbiAgICByZXNwb25zZVN0YXRlOiBJU2VydmVyUmVzcG9uc2VTdGF0ZTtcbiAgICBzZXRSZXNwb25zZVN0YXRlOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxJU2VydmVyUmVzcG9uc2VTdGF0ZT4+O1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3QgU0VSVkVSX1JFU1BPTlNFX1NUQVRFID0geyB9O1xuXG4vKiogQGludGVybmFsICovXG5jb25zdCBidXR0b25TdHlsaW5nOiBUeXBlQnV0dG9uU3R5bGVzID0ge1xuICAgIGJhY2tncm91bmRTaXplOiBcIjIwcHggMjBweFwiLFxuICAgIGJhY2tncm91bmRSZXBlYXQ6IFwibm8tcmVwZWF0XCIsXG4gICAgYmFja2dyb3VuZFBvc2l0aW9uOiBcIjEycHggMTBweFwiLFxuICAgIHRleHRJbmRlbnQ6IFwiMTlweFwiLFxuICAgIGJvcmRlcjogXCIxcHggc29saWQgI2JkYzNjN1wiLFxuICAgIHBhZGRpbmc6IFwiOXB4IDIzcHhcIixcbiAgICBib3JkZXJSYWRpdXM6IFwiOXB4XCIsXG4gICAgYmFja2dyb3VuZENvbG9yOiBcIiNiZGMzYzdcIixcbiAgICBmb250U2l6ZTogXCIxOHB4XCIsXG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIElPQXV0aFN0YXRlIHtcbiAgICBpc0F1dGhlbnRpY2F0ZWQ/OiBib29sZWFuO1xuICAgIHNldE9BdXRoU3RhdGU6IEZ1bmN0aW9uO1xuICAgIHJlc3BvbnNlU3RhdGU/OiBJU2VydmVyUmVzcG9uc2VTdGF0ZTtcbiAgICBvcHRpb25zPzogSUF1dGhvcml6YXRpb25PcHRpb25zO1xuICAgIHNldE9wdGlvbnM6IEZ1bmN0aW9uO1xuICAgIHNldFByb21wdDogRnVuY3Rpb247XG4gICAgLyoqXG4gICAgICogYGBgXG4gICAgICogICAgaW1wb3J0IHtcbiAgICAgKiAgICAgICByZXNwb25zZVN0YXRlXG4gICAgICogICB9IGZyb20gXCJyZWFjdC1nb29nbGUtb2F1dGgyXCI7XG4gICAgICpcbiAgICAgKiAgIDxHb29nbGVBdXRoPlxuICAgICAqICAgeyh7cmVzcG9uc2VTdGF0ZX0pID0+IHtcbiAgICAgKiAgICAgICAvLyBhY2Nlc3MgdGhlIHRva2VuIGZyb20gdGhlIHN0YXRlXG4gICAgICogICAgICAgY29uc29sZS5sb2cocmVzcG9uc2VTdGF0ZS5hY2Nlc3NUb2tlbikgLy8gPEFDQ0VTU19UT0tFTj5cbiAgICAgKiAgIH19XG4gICAgICogICA8L0dvb2dsZUF1dGg+XG4gICAgICogYGBgXG4gICAgICovXG4gICAgc2V0UmVzcG9uc2VTdGF0ZTogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248SVNlcnZlclJlc3BvbnNlU3RhdGU+Pjtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IERFRkFVTFRfR09PR0xFX0FVVEhfQ09OVEVYVCA9IHtcbiAgICBzZXRPQXV0aFN0YXRlOiAoKSA9PiB7fSxcbiAgICBzZXRPcHRpb25zOiAoKSA9PiB7fSxcbiAgICBzZXRQcm9tcHQ6ICgpID0+IHt9LFxuICAgIHNldFJlc3BvbnNlU3RhdGU6ICgpID0+IHt9LFxufTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IEdvb2dsZUF1dGhDb250ZXh0ID0gUmVhY3QuY3JlYXRlQ29udGV4dDxJT0F1dGhTdGF0ZT4oREVGQVVMVF9HT09HTEVfQVVUSF9DT05URVhUKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBjb25zdCBHb29nbGVBdXRoUHJvdmlkZXIgPSBHb29nbGVBdXRoQ29udGV4dC5Qcm92aWRlcjtcbi8qKlxuICogQGV4YW1wbGVcbiAqIEdldCBub3RpZmllZCB3aGVuIGEgdXNlciBoYXMgbG9nZ2VkIGluIHN1Y2Nlc3NmdWxseSBieSB3cmFwcGluZyB0aGUgR29vZ2xlQnV0dG9uXG4gKiBjb21wb25lbnQgd2l0aGluIHRoZSBHb29nbGVBdXRoIHByb3ZpZGVyLiBGb3IgZXhhbXBsZTpcbiAqIGBgYFxuICogICAgaW1wb3J0IHtcbiAqICAgICAgIEdvb2dsZUF1dGhcbiAqICAgfSBmcm9tIFwicmVhY3QtZ29vZ2xlLW9hdXRoMlwiO1xuICpcbiAqICAgPEdvb2dsZUF1dGg+XG4gKiAgIHsoe2lzQXV0aGVudGljYXRlZH0pID0+IHtcbiAqICAgICAgIC8vIGlzQXV0aGVudGljYXRlZCB3aWxsIGdldCBzZXQgdG8gdHJ1ZSB3aGVuIGEgdXNlciBoYXMgc3VjY2Vzc2Z1bGx5IGxvZ2dlZCBpbi5cbiAqICAgICAgIGNvbnNvbGUubG9nKFwidmFsdWU6IFwiLCBpc0F1dGhlbnRpY2F0ZWQpOyAvLyB2YWx1ZTogdHJ1ZSBvciBmYWxzZVxuICogICAgICAgcmV0dXJuIDxHb29nbGVCdXR0b25cbiAqICAgICAgICAgICAgICAgICAvLyBvcHRpb25zLi4uXG4gKiAgICAgICAgICAgICAgIC8+XG4gKiAgIH19XG4gKiAgIDwvR29vZ2xlQXV0aD5cbiAqIGBgYFxuICovXG5leHBvcnQgY29uc3QgR29vZ2xlQXV0aENvbnN1bWVyID0gR29vZ2xlQXV0aENvbnRleHQuQ29uc3VtZXI7XG4vKiogQGludGVybmFsICovXG5jb25zdCBfZ2V0QmFja2dyb3VuZEltZyA9IChwbGFjZWhvbGRlcjogc3RyaW5nLCBzdHlsZXM6IFR5cGVCdXR0b25TdHlsZXMpOiBUeXBlQnV0dG9uU3R5bGVzID0+IHtcbiAgICBpZihwbGFjZWhvbGRlcikge1xuICAgICAgICByZXR1cm4geyAuLi5zdHlsZXMsIGJhY2tncm91bmRJbWFnZTogYHVybCgke3BsYWNlaG9sZGVyfSlgIH07XG4gICAgfVxuICAgIHJldHVybiBzdHlsZXM7XG59XG5cbi8qKiBAaW50ZXJuYWwgKi9cbmludGVyZmFjZSBJSW5uZXJCdXR0b25Qcm9wcyBleHRlbmRzIElHb29nbGVCdXR0b24ge1xuICAgIGVycm9yPzogc3RyaW5nO1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGNvbnN0IElubmVyQnV0dG9uID0gKHByb3BzOiBJSW5uZXJCdXR0b25Qcm9wcyAmIFJlYWN0LkJ1dHRvbkhUTUxBdHRyaWJ1dGVzPEhUTUxCdXR0b25FbGVtZW50PikgPT4ge1xuICAgIGNvbnN0IHtcbiAgICAgICAgcGxhY2Vob2xkZXIgPSBcIlwiLFxuICAgICAgICBkZWZhdWx0U3R5bGUgPSB0cnVlLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBkaXNwbGF5RXJyb3JzID0gZmFsc2UsXG4gICAgfSA9IHByb3BzO1xuXG4gICAgY29uc3Qgc2NvcGVzID0gQXV0aG9yaXphdGlvbi5jcmVhdGVTY29wZXMob3B0aW9ucy5zY29wZXMpO1xuICAgIGNvbnN0IGF1dGggPSBuZXcgQXV0aG9yaXphdGlvbihvcHRpb25zLCBzY29wZXMpO1xuICAgIGF1dGguY3JlYXRlQXV0aG9yaXphdGlvblJlcXVlc3RVUkwoKTtcblxuXG4gICAgY29uc3Qgc3R5bGVzID0gZGVmYXVsdFN0eWxlID8gX2dldEJhY2tncm91bmRJbWcocGxhY2Vob2xkZXIsIGJ1dHRvblN0eWxpbmcpIDogdW5kZWZpbmVkO1xuICAgIGlmKHByb3BzLmVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFtSZWFjdC1Hb29nbGUtT0F1dGgyXSBFcnJvcjogJHtwcm9wcy5lcnJvcn1cbiAgICAgICAgIC0gVG8gZGlzcGxheSB0aGUgZXJyb3IgdG8gdGhlIHVzZXIsIHNldCBJR29vZ2xlUHJvcHMgZGlzcGxheUVycm9ycyB0byB0cnVlLlxuICAgICAgICAgU2VlIGh0dHBzOi8vam9lZ2FzZXdpY3ouZ2l0aHViLmlvL3JlYWN0LWdvb2dsZS1vYXV0aDIuMC9gKTtcbiAgICB9XG4gICAgcmVtb3ZlT0F1dGhRdWVyeVBhcmFtcygpO1xuICAgIHJldHVybiA8PlxuICAgICAgICA8YnV0dG9uIHN0eWxlPXtzdHlsZXN9IG9uQ2xpY2s9e2F1dGgucmVkaXJlY3R9IGNsYXNzTmFtZT17YCR7cHJvcHMuY2xhc3NOYW1lfSBnb29nbGUtb2F1dGgtYnRuYH0+e3Byb3BzLmNoaWxkcmVufTwvYnV0dG9uPlxuICAgICAgICB7KGRpc3BsYXlFcnJvcnMgJiYgcHJvcHMuZXJyb3IpICYmIDxkaXY+e3Byb3BzLmVycm9yfTwvZGl2Pn1cbiAgICA8Lz5cbn1cbi8qKlxuICogQGV4YW1wbGVcbiAqICoqUXVpY2sgU3RhcnQ6KipcbiAqXG4gKiBGaXJzdCBjcmVhdGUgYW4gb3B0aW9ucyBvYmplY3QgdGhhdCBpbXBsZW1lbnRzIGFuIHtAbGluayAgSUF1dGhvcml6YXRpb25PcHRpb25zfSB0eXBlLlxuICogQ2hlY2sgdGhlIHtAbGluayAgSUF1dGhvcml6YXRpb25PcHRpb25zfSBhbmQge0BsaW5rICBJQXV0aG9yaXphdGlvbkJhc2V9IHR5cGVzIGZvclxuICogYWxsIHJlcXVpcmVkIHByb3BlcnRpZXMuIFRoZW4sIHBhc3MgdGhlIG9wdGlvbnMgdG8gdGhlIHtAbGluayBHb29nbGVCdXR0b259IGNvbXBvbmVudC5cbiAqXG4gKiBgYGBcbiAqICBjb25zdCBvcHRpb25zOiAgPSB7XG4gKiAgICAgIGNsaWVudElkOiAocHJvY2Vzcy5lbnYuQ0xJRU5UX0lEIGFzIHN0cmluZyksXG4gKiAgICAgICByZWRpcmVjdFVyaTogXCJodHRwOi8vbG9jYWxob3N0OjMwMDBcIixcbiAqICAgICAgIHNjb3BlczogW1wib3BlbmlkXCIsIFwicHJvZmlsZVwiLCBcImVtYWlsXCJdLFxuICogICAgICAgaW5jbHVkZUdyYW50ZWRTY29wZXM6IHRydWUsXG4gKiAgICAgICBhY2Nlc3NUeXBlOiBcIm9mZmxpbmVcIixcbiAqICAgfTtcbiAqXG4gKiAgIDxHb29nbGVCdXR0b25cbiAqICAgICAgICAgcGxhY2Vob2xkZXI9XCJkZW1vL3NlYXJjaC5wbmdcIlxuICogICAgICAgICBvcHRpb25zPXtvcHRpb25zfVxuICogICAgICAgICBhcGlVcmw9XCJodHRwOi8vbG9jYWxob3N0OjUwMDAvZ29vZ2xlX2xvZ2luXCJcbiAqICAgLz5cbiAqIGBgYFxuICogQHBhcmFtIHByb3BzIHNlZSBJR29vZ2xlQnV0dG9uXG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIEdvb2dsZUJ1dHRvbihwcm9wczogVHlwZUdvb2dsZUJ1dHRvbikge1xuICAgIGNvbnN0IHtjYWxsYmFja30gPSBwcm9wcztcbiAgICBjb25zdCB7IG9wdGlvbnMsIHNldE9wdGlvbnMsIHJlc3BvbnNlU3RhdGUsIHNldE9BdXRoU3RhdGUsIHNldFJlc3BvbnNlU3RhdGUsIGlzQXV0aGVudGljYXRlZCB9ID0gdXNlQ29udGV4dDxJT0F1dGhTdGF0ZT4oR29vZ2xlQXV0aENvbnRleHQpO1xuICAgIGNvbnN0IFtzZXJ2ZXJSZXNwb25zZVN0YXRlLCBzZXRTZXJ2ZXJSZXNwb25zZVN0YXRlXSA9IHVzZVN0YXRlPElTZXJ2ZXJSZXNwb25zZT4oKTtcbiAgICBjb25zdCBjdXJyZW50VXJsID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcbiAgICBjb25zdCBxdWVyeVBhcmFtc0NvZGUgPSBjdXJyZW50VXJsLmdldChcImNvZGVcIik7XG4gICAgY29uc3QgcXVlcnlQYXJhbXNFcnJvciA9IGN1cnJlbnRVcmwuZ2V0KFwiZXJyb3JcIik7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCFvcHRpb25zICYmIHNldE9wdGlvbnMpIHtcbiAgICAgICAgICAgIHNldE9wdGlvbnMocHJvcHMub3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICB9LCBbcHJvcHMub3B0aW9uc10pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmKHJlc3BvbnNlU3RhdGUgJiYgIU9iamVjdC5rZXlzKHJlc3BvbnNlU3RhdGUpLmxlbmd0aCAmJiBzZXJ2ZXJSZXNwb25zZVN0YXRlKSB7XG4gICAgICAgICAgICBzZXJ2ZXJSZXNwb25zZShzZXJ2ZXJSZXNwb25zZVN0YXRlKTtcbiAgICAgICAgfVxuICAgIH0sIFtzZXJ2ZXJSZXNwb25zZVN0YXRlLCByZXNwb25zZVN0YXRlXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYocmVzcG9uc2VTdGF0ZT8uYWNjZXNzVG9rZW4gJiYgIWlzTG9nZ2VkSW4oKSkge1xuICAgICAgICAgICAgc3RvcmVBY2Nlc3NUb2tlbihyZXNwb25zZVN0YXRlLmFjY2Vzc1Rva2VuIGFzIHN0cmluZyk7XG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKFwiYGFjY2Vzc1Rva2VuYCBzZXQgaW4gbG9jYWwgc3RvcmFnZS5cIik7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNldE9BdXRoU3RhdGUgPT09IFwiZnVuY3Rpb25cIiAmJiAhaXNBdXRoZW50aWNhdGVkKSB7XG4gICAgICAgICAgICAgICAgc2V0T0F1dGhTdGF0ZSh0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sIFtyZXNwb25zZVN0YXRlPy5hY2Nlc3NUb2tlbl0pO1xuICAgIC8vIEFkZCBhbnkgdXBkYXRlcyB0byB0aGUgb3B0aW9ucyBzdGF0ZVxuICAgIGxldCBtZXJnZWRQcm9wc0FuZFN0YXRlT3B0aW9ucyA9IHtcbiAgICAgICAgLi4ucHJvcHMub3B0aW9ucyxcbiAgICAgICAgLi4ub3B0aW9ucyxcbiAgICB9XG4gICAgbGV0IF9pbm5lciA9XG4gICAgICAgIDxJbm5lckJ1dHRvblxuICAgICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICAgICAgcGxhY2Vob2xkZXI9e3Byb3BzLnBsYWNlaG9sZGVyfVxuICAgICAgICAgICAgZXJyb3I9e3Jlc3BvbnNlU3RhdGU/LmVycm9yfVxuICAgICAgICAgICAgb3B0aW9ucz17bWVyZ2VkUHJvcHNBbmRTdGF0ZU9wdGlvbnN9XG4gICAgICAgIC8+O1xuICAgIGlmIChyZXNwb25zZVN0YXRlPy5lcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBbUmVhY3QtR29vZ2xlLU9BdXRoMl0gRXJyb3I6IEFwaSBjYWxsIGZhaWxlZCB3aXRoICR7cmVzcG9uc2VTdGF0ZT8uZXJyb3J9IGVycm9yLmApO1xuICAgICAgICByZXR1cm4gX2lubmVyO1xuICAgIH0gZWxzZSBpZiAocXVlcnlQYXJhbXNDb2RlICYmICFpc0xvZ2dlZEluKCkpIHtcbiAgICAgICAgLy8gR2V0IHJlc3Qgb2YgcGFyYW1zXG4gICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zRW1haWwgPSBjdXJyZW50VXJsLmdldChcImVtYWlsXCIpIHx8IFwiXCI7XG4gICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zU2NvcGUgPSBjdXJyZW50VXJsLmdldChcInNjb3BlXCIpIHx8IFwiXCI7XG4gICAgICAgIGNvbnN0IHNlcnZlclJlc3BvbnNlUHJvcHM6IElTZXJ2ZXJSZXNwb25zZSA9IHtcbiAgICAgICAgICAgIGVtYWlsOiBxdWVyeVBhcmFtc0VtYWlsLFxuICAgICAgICAgICAgc2NvcGU6IHF1ZXJ5UGFyYW1zU2NvcGUsXG4gICAgICAgICAgICBjb2RlOiBxdWVyeVBhcmFtc0NvZGUsXG4gICAgICAgICAgICBjbGllbnRfaWQ6IHByb3BzLm9wdGlvbnMuY2xpZW50SWQsXG4gICAgICAgICAgICBhcGlVcmw6IHByb3BzLmFwaVVybCxcbiAgICAgICAgICAgIHJlc3BvbnNlU3RhdGU6IHJlc3BvbnNlU3RhdGUgYXMgSVNlcnZlclJlc3BvbnNlU3RhdGUsXG4gICAgICAgICAgICBzZXRSZXNwb25zZVN0YXRlOiBzZXRSZXNwb25zZVN0YXRlIGFzIERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPElTZXJ2ZXJSZXNwb25zZVN0YXRlPj4sXG4gICAgICAgIH07XG4gICAgICAgIHJlbW92ZU9BdXRoUXVlcnlQYXJhbXMoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlU3RhdGUgJiYgIU9iamVjdC5rZXlzKHJlc3BvbnNlU3RhdGUpLmxlbmd0aCkge1xuICAgICAgICAgICAgc2V0U2VydmVyUmVzcG9uc2VTdGF0ZShzZXJ2ZXJSZXNwb25zZVByb3BzKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmRlYnVnKFwiV2FpdGluZyBmb3IgcmVtb3RlIGFwaSByZXNwb25zZVwiKTtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrID8gY2FsbGJhY2soKSA6IDw+TG9hZGluZy4uLjwvPjtcbiAgICB9IGVsc2UgaWYgKHF1ZXJ5UGFyYW1zRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3I6IEdvb2dsZSBsb2dpbiBhdHRlbXB0IGZhaWxlZCB3aXRoICR7cXVlcnlQYXJhbXNFcnJvcn0gZXJyb3IuYClcbiAgICAgICAgcmV0dXJuIF9pbm5lcjtcbiAgICB9XG4gICAgLy8gRGlzcGxheSBidXR0b24gd2l0aCBubyBlcnJvcnNcbiAgICByZXR1cm4gX2lubmVyO1xufVxuXG4vKipcbiAqXG4gKiBAcGFyYW0gc2V0T3B0aW9uc1xuICogQHBhcmFtIG9wdGlvbnNcbiAqIElmIGZvciBleGFtcGxlIHlvdXIgdXNlciB1cGRhdGVzIHRoZWlyIGVtYWlsIGluIHlvdXIgYXBwICYgeW91IHJlZGlyZWN0IHRoZW1cbiAqIHRvIHRoZSBsb2dpbiBhZ2FpbiwgR29vZ2xlIHdpbGwgYnkgZGVmYXVsdCBza2lwIHRoZSBHb29nbGUgZW1haWwgc2VsZWN0IHNjcmVlblxuICogJiBsb2cgeW91IGluIHdpdGggeW91ciBleGlzdGluZyBjcmVkZW50aWFscy4gVG8gc3RvcCB0aGlzIGhhcHBlbmluZyB5b3UgY2FuIHVzZSB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uOlxuICpcbiAqIGBgYFxuICogIHNldFByb21wdChcInNlbGVjdF9hY2NvdW50XCIpO1xuICogYGBgXG4gKlxuICogQmVsb3cgaXMgYW4gZXhhbXBsZSB3aXRoIGBzZXRQcm9tcHRgIGZ1bmN0aW9uIHJlc2V0dGluZyB5b3VyXG4gKiBgYGBcbiAqICAgY29uc3Qgc3NvX29wdGlvbnM6IElBdXRob3JpemF0aW9uT3B0aW9ucyA9IHtcbiAqICAgICAgY2xpZW50SWQ6IFwiPENMSUVOVF9JRD5cIixcbiAqICAgICAgcmVkaXJlY3RVcmk6IGBodHRwOi8vbG9jYWxob3N0OjMwMDAvbG9naW5gLFxuICogICAgICBzY29wZXM6IFtcIm9wZW5pZFwiLCBcInByb2ZpbGVcIiwgXCJlbWFpbFwiXSxcbiAqICAgICAgYWNjZXNzVHlwZTogXCJvZmZsaW5lXCIsXG4gKiAgIH07XG4gKiBgYGBcbiAqIFRoZW4gaW4geW91ciBsb2dpbiBjb21wb25lbnQsIGl0IGNvdWxkIGxvb2sgbGlrZSB0aGlzOlxuICogYGBgXG4gKiAgIDxHb29nbGVBdXRoPlxuICogICA8R29vZ2xlQXV0aENvbnN1bWVyPlxuICogICB7KHsgcmVzcG9uc2VTdGF0ZSwgaXNBdXRoZW50aWNhdGVkLCBzZXRQcm9tcHQgfTogSU9BdXRoU3RhdGUpID0+IHtcbiAqICAgICBpZiAoIWlzQXV0aGVudGljYXRlZCkge1xuICogICAgICAgICAvLyBIZXJlIHdlIGFyZSB1c2luZyBMb2Rhc2ggZnAgdG8gZ2V0IG91ciBwcm9tcHQgdmFsdWVcbiAqICAgICAgICAgLy8gcGFzc2VkIGZyb20gdGhlIFJlYWN0IFJvdXRlciBsb2NhdGlvbiBBUEkgZS5nOlxuICogICAgICAgICAvLyBoaXN0b3J5LnB1c2goeyBwYXRobmFtZTogXCIvbG9naW5cIiwge3Byb21wdDogXCJzZWxlY3RfYWNjb3VudFwifSk7XG4gKiAgICAgICAgIGNvbnN0IHByb21wdCA9IGZwLmdldChcInN0YXRlLnByb21wdFwiLCBsb2NhdGlvbik7XG4gKiAgICAgICAgIGlmIChwcm9tcHQpIHtcbiAqICAgICAgICAgICAgLy8gdGhpcyB3aWxsIG5vdyBzZXQgc3NvX29wdGlvbi5wcm9tcHQgPSBcInNlbGVjdF9hY2NvdW50XCJcbiAqICAgICAgICAgICAgLy8gZm9yIHRoaXMgbG9naW4gYXR0ZW1wdCwgdGhlbiB0aGUgYXV0byBsb2dpbiBmbG93IHdpbGxcbiAqICAgICAgICAgICAvLyBjb250aW51ZSBhcyBub3JtYWxcbiAqICAgICAgICAgICAgIHNldFByb21wdChwcm9tcHQpO1xuICogICAgICAgICB9XG4gKiAgICAgICAgIHJldHVybiA8U3R5bGVkR29vZ2xlQnV0dG9uPlxuICogICAgICAgICAgICAgICAgIDxHb29nbGVCdXR0b25cbiAqICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFN0eWxlPXtmYWxzZX1cbiAqICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucz17c3NvX29wdGlvbn1cbiAqICAgICAgICAgICAgICAgICAgICAgYXBpVXJsPVwiaHR0cDovL2xvY2FsaG9zdDozMDAwL3VzZXJzL2xvZ2luXCJcbiAqICAgICAgICAgICAgICAgICA+TG9naW48L0dvb2dsZUJ1dHRvbj5cbiAqICAgICAgICAgICAgIDwvU3R5bGVkR29vZ2xlQnV0dG9uPjtcbiAqICAgICAgICB9IGVsc2Uge1xuICogICAgICAgICAgICAgaWYgKHJlc3BvbnNlU3RhdGU/LmFjY2Vzc1Rva2VuICYmIGlzT0F1dGhMb2dnZWRJbigpKSB7XG4gKiAgICAgICAgICAgICAgICAgdXBkYXRlU2hvdWxkRmV0Y2goaXNPQXV0aExvZ2dlZEluKCkpO1xuICogICAgICAgICAgICAgICAgIGlmIChzdGFmZikge1xuICogICAgICAgICAgICAgICAgICAgIHJldHVybiA8UmVkaXJlY3QgdG89XCIvc3RhZmZcIi8+O1xuICogICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gKiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICogICAgICAgICAgICAgICAgIH1cbiAqICAgICAgICAgICAgIH1cbiAqICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gKiAgICAgICAgIH1cbiAqICAgICAgICAgIH19XG4gKiAgICAgIDwvR29vZ2xlQXV0aENvbnN1bWVyPlxuICogICA8L0dvb2dsZUF1dGg+XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldFByb21wdChzZXRPcHRpb25zOiBGdW5jdGlvbiwgb3B0aW9ucz86IElBdXRob3JpemF0aW9uT3B0aW9ucykge1xuICAgIHJldHVybiAocHJvbXB0VHlwZTogVHlwZVByb21wdCkgPT4ge1xuICAgICAgICBpZiAob3B0aW9ucyAmJiAhb3B0aW9ucy5wcm9tcHQpIHtcbiAgICAgICAgICAgIHNldE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICAgICAgcHJvbXB0OiBwcm9tcHRUeXBlLFxuICAgICAgICAgICAgfSBhcyBJQXV0aG9yaXphdGlvbk9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgfTtcbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIHByb3BzXG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZXhwb3J0IGNvbnN0IEdvb2dsZUF1dGggPSAocHJvcHM6IGFueSkgPT4ge1xuICAgIGNvbnN0IFtyZXNwb25zZVN0YXRlLCBzZXRSZXNwb25zZVN0YXRlXSA9IHVzZVN0YXRlPElTZXJ2ZXJSZXNwb25zZVN0YXRlPihTRVJWRVJfUkVTUE9OU0VfU1RBVEUpO1xuICAgIGNvbnN0IFtpc0F1dGhlbnRpY2F0ZWQsIHNldE9BdXRoU3RhdGVdID0gdXNlU3RhdGU8Ym9vbGVhbj4oaXNMb2dnZWRJbigpKTtcbiAgICBjb25zdCBbb3B0aW9ucywgc2V0T3B0aW9uc10gPSB1c2VTdGF0ZTxJQXV0aG9yaXphdGlvbk9wdGlvbnM+KCk7XG5cbiAgICBjb25zdCBfcHJvdmlkZXJQcm9wczogSU9BdXRoU3RhdGUgPSB7XG4gICAgICAgIGlzQXV0aGVudGljYXRlZCxcbiAgICAgICAgc2V0T0F1dGhTdGF0ZSxcbiAgICAgICAgcmVzcG9uc2VTdGF0ZSxcbiAgICAgICAgc2V0UmVzcG9uc2VTdGF0ZSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgc2V0T3B0aW9ucyxcbiAgICAgICAgc2V0UHJvbXB0OiBzZXRQcm9tcHQoc2V0T3B0aW9ucywgb3B0aW9ucyksXG4gICAgfTtcbiAgICByZXR1cm4gIChcbiAgICAgICAgPEdvb2dsZUF1dGhQcm92aWRlciB2YWx1ZT17X3Byb3ZpZGVyUHJvcHN9PlxuICAgICAgICAgICAge3Byb3BzLmNoaWxkcmVufVxuICAgICAgICA8L0dvb2dsZUF1dGhQcm92aWRlcj5cbiAgICApO1xufSJdLCJzb3VyY2VSb290IjoiIn0=